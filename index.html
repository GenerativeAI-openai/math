<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>í•œêµ­ ìˆ˜í•™ ë¬¸ì œ í’€ì´</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body { font-family: Arial; padding: 20px; text-align: center; }
    .card { border: 1px solid #ccc; border-radius: 12px; padding: 20px; max-width: 500px; margin: 0 auto; }
    .svg-container, .image { margin-top: 10px; }
    .image img { max-width: 100%; height: auto; }
    select { margin-bottom: 15px; padding: 8px; font-size: 16px; }
    canvas { width: 200px !important; height: 200px !important; }
  </style>
</head>
<body>
  <h1>ğŸ“˜ í•œêµ­ ìˆ˜í•™ ë¬¸ì œ í’€ì´</h1>
  <select id="gradeSelect" onchange="filterByGrade()">
    <option value="ì „ì²´">ì „ì²´ í•™ë…„</option>
    <option value="ì´ˆ1">ì´ˆ1</option>
    <option value="ì´ˆ2">ì´ˆ2</option>
    <option value="ì´ˆ3">ì´ˆ3</option>
    <option value="ì´ˆ4">ì´ˆ4</option>
    <option value="ì´ˆ5">ì´ˆ5</option>
    <option value="ì´ˆ6">ì´ˆ6</option>
    <option value="ì¤‘1">ì¤‘1</option>
    <option value="ì¤‘2">ì¤‘2</option>
    <option value="ì¤‘3">ì¤‘3</option>
  </select>
  <div class="card">
    <div id="question" class="question">ë¬¸ì œ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
    <div id="image" class="image"></div>
    <div id="svgContainer" class="svg-container"></div>
    <input type="text" id="answerInput" placeholder="ì •ë‹µì„ ì…ë ¥í•˜ì„¸ìš”"/>
    <button onclick="checkAnswer()">ì œì¶œ</button>
    <div id="result" class="result"></div>
  </div>
  <canvas id="pieChart"></canvas>

  <script>
    let current = 0;
    let stats = { AC: 0, WA: 0 };
    let problems = [];
    let filtered = [];

    async function fetchProblems() {
      const res = await fetch('problems.json');
      problems = await res.json();
      filtered = problems;
      loadQuestion();
    }

    function filterByGrade() {
      const grade = document.getElementById('gradeSelect').value;
      filtered = (grade === 'ì „ì²´') ? problems : problems.filter(p => p.grade === grade);
      current = 0;
      loadQuestion();
    }

    function loadQuestion() {
      const p = filtered[current];
      document.getElementById('question').innerText = `[${p.grade}] ${p.question}`;
      document.getElementById('answerInput').value = '';
      document.getElementById('result').innerText = '';
      document.getElementById('image').innerHTML = p.image ? `<img src="images/${p.image}" />` : '';
      if (p.svg) {
        fetch(`svgs/${p.svg}`).then(r => r.text()).then(svg => {
          document.getElementById('svgContainer').innerHTML = svg;
        });
      } else {
        document.getElementById('svgContainer').innerHTML = '';
      }
    }

    function checkAnswer() {
      const input = document.getElementById('answerInput').value.trim();
      const correct = filtered[current].answer === input;
      if (correct) {
        stats.AC++;
        document.getElementById('result').innerText = 'ì •ë‹µì…ë‹ˆë‹¤!';
        document.getElementById('result').style.color = 'green';
      } else {
        stats.WA++;
        document.getElementById('result').innerText = 'ì˜¤ë‹µì…ë‹ˆë‹¤.';
        document.getElementById('result').style.color = 'red';
      }
      updateChart();
      setTimeout(() => {
        current = (current + 1) % filtered.length;
        loadQuestion();
      }, 1200);
    }

    function updateChart() {
      new Chart(document.getElementById('pieChart'), {
        type: 'pie',
        data: {
          labels: ['ì •ë‹µ (AC)', 'ì˜¤ë‹µ (WA)'],
          datasets: [{ data: [stats.AC, stats.WA], backgroundColor: ['#4ade80', '#f87171'] }]
        },
        options: {
          responsive: false,
          plugins: { legend: { display: true, position: 'bottom' } }
        }
      });
    }

    fetchProblems();
  </script>
</body>
</html>
